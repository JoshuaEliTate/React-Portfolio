(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[39470],{67142:function(e,r,t){"use strict";t.d(r,{cP:function(){return U},xI:function(){return R},BE:function(){return k}});var n=t(7406),o=t(14633),a=t.n(o),c=t(29901),u=t(53824),l=t.n(u),i=t(89309),s=t.n(i);function p(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function d(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?p(Object(t),!0).forEach((function(r){(0,n.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):p(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function f(e){const r=Object.keys(e);let t={};for(const n of r){const r=s()(n);t=d(d({},t),{},{[r]:e[n]})}return t}var y=t(49335),O=t.n(y);function b(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function E(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?b(Object(t),!0).forEach((function(r){(0,n.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):b(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}const g=["cancel","resume","pause","service","api_app","upload_type","id","bytes_uploaded","initial_size","video_file_id","uid","signature","_state","file","error","attempt_id","clip_id"];function m(e){const r=f(O()(e,g)),{folder_id:t,target_user_id:n}=r.file;return E(E({},r),{},{targetUserId:n,folderId:t})}var P=t(97687),S=t.n(P);function j(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function h(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?j(Object(t),!0).forEach((function(r){(0,n.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):j(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}const v=/vuid=(\w+\.\w+);?/;const w=e=>({type:"LOADING",payload:{loading:e}}),A=e=>({type:"FILE_SELECT_STATE_CHANGE",payload:{isFileSelectOpen:e}});async function I(e,r,t,n){const o={headers:{Authorization:r?`jwt ${r}`:`bearer ${t}`}},a=n?function(e){let r="?";const t=Object.keys(e);for(let n=0;n<t.length;n++){const o=t[n],a=e[o];a&&(r+=0!==n?`&${S()(o)}=${encodeURIComponent(a)}`:`${S()(o)}=${encodeURIComponent(a)}`)}return r}(n):"",c=await fetch(`https://${e}/upload/config${a}`,o);if(200!==c.status)throw new Error(c.statusText);return c.json()}var D=t(61250);function _(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function C(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?_(Object(t),!0).forEach((function(r){(0,n.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):_(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}const T={service:"",hasBeenInitialized:!1,loading:!1,isFileSelectOpen:!1,uploads:[],uploaderSummary:{activeCount:0,bytesUploaded:0,canceledCount:0,completeCount:0,failedCount:0,eta:0,hasFailures:!1,inProgressCount:0,isCanceled:!1,isPaused:!1,isComplete:!1,queuedCount:0,totalBytes:0,totalCount:0}},L=C(C({},T),{},{upload:(e,r)=>null,cancelAll:()=>null,resumeAll:()=>null,pauseAll:()=>null,clearAll:()=>null,clear:()=>null,fileSelectStateChange:e=>null,addShouldUploadStartCallback:e=>null}),U=c.createContext(L),R=c.createContext({addUploadLifecycleListener:()=>()=>null});function N(e,r){let t;switch(r.type){case"REMOVE":return t=e.uploads.filter((e=>e.id!==r.payload.upload.id)),C(C({},e),{},{uploads:t});case"RESET":return C(C({},T),{},{hasBeenInitialized:!0});case"LOADING":return C(C({},e),{},{loading:r.payload.loading});case"UPLOAD":return C(C({},e),{},{uploads:[...e.uploads,...r.payload.uploads]});case"UPLOAD_STATE_CHANGE":return t=e.uploads.map((e=>e.id===r.payload.upload.id?r.payload.upload:e)),C(C({},e),{},{uploads:t,uploaderSummary:r.payload.uploaderSummary});case"UPLOAD_PROGRESS":return t=e.uploads.map((e=>e.id===r.payload.uploadProgressEvent.id?C(C({},e),{},{bytesUploaded:r.payload.uploadProgressEvent.bytes_uploaded,eta:r.payload.uploadProgressEvent.eta,speedMbps:r.payload.uploadProgressEvent.speed_mbps}):e)),C(C({},e),{},{uploads:t,uploaderSummary:r.payload.uploaderSummary});case"FILE_SELECT_STATE_CHANGE":return C(C({},e),{},{isFileSelectOpen:r.payload.isFileSelectOpen});case"SET_UPLOAD_SERVICE":return C(C({},e),{},{service:r.payload.service});case"INITIALIZE":return C(C({},e),{},{hasBeenInitialized:!0});default:return e}}function k(e){const{0:r,1:t}=(0,c.useReducer)(N,T),n=(0,c.useRef)(),o=(0,c.useRef)([]),i=(0,c.useRef)([]),s=(0,c.useRef)((()=>!0)),p=()=>n.current?.summary?f(n.current?.summary):{};return(0,c.useEffect)((()=>{e.init&&!r.hasBeenInitialized&&t({type:"INITIALIZE"})}),[e.init,r.hasBeenInitialized]),(0,c.useEffect)((()=>{n.current?.setVimeoJWT(e.jwt)}),[e.jwt]),(0,c.useEffect)((()=>{const a=async()=>{t(w(!0));try{const r=(window.location.search||window.location.search).substr(1).split("&").map((e=>e.split("="))).filter((e=>{let[r]=e;return/\S/.test(r)})).reduce(((e,r)=>{let[t,n]=r;return h(h({},e),{},{[t]:n})}),{}),o=await I(e.apiUrl,e.jwt,e.basicAuthToken,r),a=e.xsrft?C(C({},o),{},{xsrft:e.xsrft}):o;t({type:"SET_UPLOAD_SERVICE",payload:{service:a.service}}),a.vuid||(a.vuid=function(){const e=document.cookie.match(v);return e&&e.length>=2?e[1]:""}()),n.current=new(l())(C(C({},a),{},{embeddableUploaderVersion:"3.0.0"}),void 0)}catch(r){console.error("Error configuring uploader: ",r)}finally{t(w(!1))}};return r.hasBeenInitialized&&!n.current&&!r.loading&&e.apiUrl&&(e.jwt||e.basicAuthToken)&&a(),()=>{(r.uploaderSummary.isCanceled||r.uploaderSummary.isComplete)&&(o.current.forEach((e=>e())),o.current=[])}}),[r.loading,r.hasBeenInitialized,r.uploaderSummary.isCanceled,r.uploaderSummary.isComplete,e.apiUrl,e.jwt,e.basicAuthToken,e.xsrft]),(0,D.jsx)(U.Provider,{value:C({upload:(e,r,c)=>{if(!s.current(e))return;let l=[];const d=n.current?.config?.service||u.SERVICES.UPLOAD_SERVICE_SITE,f=Array.isArray(e)?e:function(e,r){return Array.from(e).map((e=>(e.target_user_id=r?.targetUserId,e.folder_id=r?.folderId,e)))}(e,r),y=r.apiApp||u.SERVICE_APP_IDS[d];l=n.current?.upload(f,r.uploadType??u.TYPES.CLIP,y,r.clipId?r.clipId.toString():null,c),Array.isArray(l)||(l=[l]),l.forEach((e=>{const r=a()((r=>{t({type:"UPLOAD_PROGRESS",payload:{uploadProgressEvent:C(C({},r),{},{id:e.id}),uploaderSummary:p()}})}),1e3),n=e=>{const r=m(e.upload);i.current.forEach((e=>e(r.state,r))),t(((e,r)=>({type:"UPLOAD_STATE_CHANGE",payload:{upload:e,uploaderSummary:r}}))(r,p()))};e.on(u.EVENTS.STATE_CHANGE,n),e.on(u.EVENTS.PROGRESS,r),o.current.push((()=>{e.removeListener(u.EVENTS.STATE_CHANGE,n),e.removeListener(u.EVENTS.PROGRESS,r)}))}));const O=l.map(m);t((e=>({type:"UPLOAD",payload:{uploads:e}}))(O))},pauseAll:()=>n.current?.pauseAll(),resumeAll:()=>n.current?.resumeAll(),cancelAll:()=>n.current?.cancelAll(),clearAll:()=>{n.current?.clearAll(),t({type:"RESET"})},clear:e=>{if(n.current){const r=n.current.uploads.get(e.id);r&&(n.current.clear(r),t((e=>({type:"REMOVE",payload:{upload:e}}))(e)))}},fileSelectStateChange:e=>{if(t(A(e)),e){const e=()=>{t(A(!1)),document.body.removeEventListener("focus",e)};document.body.addEventListener("focus",e)}},addShouldUploadStartCallback:e=>{s.current=e}},r),children:(0,D.jsx)(R.Provider,{value:{addUploadLifecycleListener:e=>(i.current.push(e),()=>{i.current=i.current.filter((r=>r!==e))})},children:e.children})})}},71021:function(){},42212:function(e,r,t){"use strict";t.d(r,{u:function(){return a}});var n=t(29901),o=t(67142);function a(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const{addUploadLifecycleListener:t}=(0,n.useContext)(o.xI),a=(0,n.useCallback)(e,[e,r]);(0,n.useEffect)((()=>t(a)),[t,a,...r])}},73918:function(e,r,t){"use strict";t.d(r,{J:function(){return a}});var n=t(29901),o=t(67142);function a(){return(0,n.useContext)(o.cP)}},58573:function(e,r,t){"use strict";t.d(r,{O:function(){return p}});var n=t(7406),o=t(30338),a=(t(29901),t(350)),c=t(73918),u=t(61250);const l=["children","className","folderId","targetUserId","onDrop","onDragEnd","onDragLeave","onDragOver"];function i(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function s(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?i(Object(t),!0).forEach((function(r){(0,n.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function p(e){let{children:r,className:t,folderId:n,targetUserId:i,onDrop:p,onDragEnd:d,onDragLeave:f,onDragOver:y}=e,O=(0,o.Z)(e,l);const{upload:b}=(0,c.J)();return(0,u.jsx)(a.f,s(s({className:t,onDragOver:y,onDragLeave:f,onChange:e=>{if(p)p(e);else{let r=e.target.files;r&&b(r,{folderId:n,targetUserId:i})}d&&d(e)}},O),{},{children:r}))}},39470:function(e,r,t){"use strict";t.r(r),t.d(r,{InputModal:function(){return a.f},ProgressToast:function(){return o.ay},ThumbnailGenerator:function(){return i.G},UploadDropzone:function(){return c.O},useUploadLifecycle:function(){return l.u},useUploader:function(){return u.J}});var n=t(67142),o=t(9944),a=t(33804),c=t(58573),u=t(73918),l=t(42212),i=t(30687),s=t(71021),p={};for(var d in s)["default","ProgressToast","InputModal","UploadDropzone","useUploader","useUploadLifecycle","ThumbnailGenerator"].indexOf(d)<0&&(p[d]=function(e){return s[e]}.bind(0,d));t.d(r,p),r.default=n.BE}}]);